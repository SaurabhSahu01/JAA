# This is a workflow that converts images to the WebP format

name: Produce WebP images

# Controls when the workflow will run.
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
  # Triggers the workflow on push events for the main and Front-end branches
  push:
    branches:
    - main
    - preview

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "convert-no-destruct"
  convert-no-destruct:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Print current path
      run: pwd
      
    - name: Print directory contents
      run: ls
      
    - name: Convert PNG images
      run: find . -mindepth 1 -type f -iname "*.png" | xargs -d '\n' mogrify -format webp -auto-orient
      
    - name: Convert JPG images
      run: |
          find . -mindepth 1 -type f -iname "*.jpg" | xargs -d '\n' mogrify -format webp -auto-orient
          find . -mindepth 1 -type f -iname "*.jpeg" | xargs -d '\n' mogrify -format webp -auto-orient
      
    - name: Commit changes
      # if: (git diff HEAD --name-only | wc -l) > 0
      run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "Produced WebP Images" -v
          git push
      continue-on-error: true
